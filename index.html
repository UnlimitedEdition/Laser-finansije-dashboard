<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laser Potrošnja i Prihodi</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>
    <script type="module" src="js/security.js"></script>
    <script type="module" src="js/app.js"></script>
    <script type="module" src="js/povrsina.js"></script>
    <style>
        body { background: #0a1929; color: white; }
        .container { max-width: 1200px; margin-top: 20px; }
        .dashboard-card {
            background: #132f4c;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .metric-card {
            background: #132f4c;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            min-height: 120px;
        }
        .metric-title {
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 10px;
        }
        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
        }
        .chart-container {
            background: #132f4c;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
        }
        table {
            background: #132f4c;
            color: white;
        }
        .table-bordered {
            border-color: #1e4976;
        }
        .table-bordered td, .table-bordered th {
            border-color: #1e4976;
        }
        .form-control {
            background: #1e4976;
            border-color: #1e4976;
            color: white;
        }
        .form-control:focus {
            background: #1e4976;
            border-color: #2977c9;
            color: white;
            box-shadow: none;
        }
        .form-control::placeholder {
            color: #888;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="row mb-4">
        <div class="col-12">
            <div class="dashboard-card">
                <div class="d-flex justify-content-between align-items-center">
                    <h2 class="mb-0">Laser - Finansijski Dashboard</h2>
                    <div class="d-flex gap-2">
                        <select class="form-select" id="godinaSelect">
                            <option value="2025">2025</option>
                            <option value="2024">2024</option>
                        </select>
                        <select class="form-select" id="mesecSelect">
                            <option value="all">Svi meseci</option>
                            <option value="1">Januar</option>
                            <option value="2">Februar</option>
                            <option value="3">Mart</option>
                            <option value="4">April</option>
                            <option value="5">Maj</option>
                            <option value="6">Jun</option>
                            <option value="7">Jul</option>
                            <option value="8">Avgust</option>
                            <option value="9">Septembar</option>
                            <option value="10">Oktobar</option>
                            <option value="11">Novembar</option>
                            <option value="12">Decembar</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-3">
            <div class="metric-card">
                <div class="metric-title">UKUPAN PRIHOD</div>
                <div class="metric-value" id="ukupanPrihod">0 RSD</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric-card">
                <div class="metric-title">UKUPAN RASHOD</div>
                <div class="metric-value" id="ukupanRashod">0 RSD</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric-card">
                <div class="metric-title">PROFIT</div>
                <div class="metric-value" id="ukupanProfit">0 RSD</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric-card">
                <div class="metric-title">NETO MARŽA</div>
                <div class="metric-value" id="netoMarza">0%</div>
            </div>
        </div>
    </div>

    <form id="potrosnjaForm" class="mb-4 dashboard-card">
        <div class="row g-2">
            <div class="col-md-3">
                <input type="text" class="form-control" name="materijal" placeholder="Materijal (npr. lepak)" required>
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control" name="kolicina" placeholder="Količina" required>
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control" name="cena" placeholder="Cena po jedinici" required>
            </div>
            <div class="col-md-2">
                <input type="date" class="form-control" name="datum" required>
            </div>
            <div class="col-md-3">
                <button type="submit" class="btn btn-primary w-100">Dodaj potrošnju</button>
            </div>
        </div>
    </form>
    <form id="prihodForm" class="mb-4">
        <div class="row g-2">
            <div class="col-md-3">
                <input type="text" class="form-control" name="opis" placeholder="Opis prodaje" required>
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control" name="iznos" placeholder="Iznos" required>
            </div>
            <div class="col-md-2">
                <input type="date" class="form-control" name="datum" required>
            </div>
            <div class="col-md-3">
                <button type="submit" class="btn btn-success w-100">Dodaj prihod</button>
            </div>
        </div>
    </form>
    <div class="chart-container">
        <canvas id="saldoChart"></canvas>
    </div>
    <div class="chart-container">
        <canvas id="materijalChart"></canvas>
    </div>
    <h4>Potrošnja materijala</h4>
    <table class="table table-bordered" id="potrosnjaTabela">
        <thead>
            <tr>
                <th>Materijal</th>
                <th>Količina</th>
                <th>Cena po jedinici</th>
                <th>Ukupno</th>
                <th>Datum</th>
                <th>Obriši</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    <h4>Prihodi</h4>
    <table class="table table-bordered" id="prihodTabela">
        <thead>
            <tr>
                <th>Opis</th>
                <th>Iznos</th>
                <th>Datum</th>
                <th>Obriši</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    <div class="dashboard-card mt-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="mb-0">Upravljanje podacima</h4>
            <div>
                <button class="btn btn-primary me-2" onclick="exportData()">Izvezi podatke</button>
                <button class="btn btn-primary me-2" onclick="document.getElementById('importFile').click()">Uvezi podatke</button>
                <input type="file" id="importFile" style="display: none" onchange="importData(event)">
                <button class="btn btn-danger" onclick="if(confirm('Da li ste sigurni? Ovo će obrisati sve podatke.')) clearData()">Obriši sve podatke</button>
            </div>
        </div>
        <div class="alert alert-info">
            <strong>Info:</strong> Svi podaci se čuvaju lokalno u vašem browseru. Koristite dugmad iznad za prenos podataka između računara.
        </div>
    </div>
</div>

<script type="module">
    import { initPovrsina } from './js/povrsina.js';
    import { initApp } from './js/app.js';

    // Load components
    const components = [
        { id: 'header', path: 'components/header.html' },
        { id: 'metrics', path: 'components/metrics.html' },
        { id: 'jobForm', path: 'components/job-form.html' },
        { id: 'charts', path: 'components/charts.html' },
        { id: 'tables', path: 'components/tables.html' },
        { id: 'dataManagement', path: 'components/data-management.html' },
        { id: 'purchaseForm', path: 'components/purchase-form.html' },
        { id: 'purchaseHistory', path: 'components/purchase-history.html' }
    ];

    async function loadComponents() {
        for (const component of components) {
            try {
                const response = await fetch(component.path);
                if (!response.ok) throw new Error(`Failed to load ${component.path}`);
                const html = await response.text();
                document.getElementById(component.id).innerHTML = html;
            } catch (error) {
                console.error(`Error loading component ${component.path}:`, error);
                document.getElementById(component.id).innerHTML = `
                    <div class="alert alert-danger">
                        Failed to load component. Please refresh the page or contact support.
                    </div>
                `;
            }
        }
    }

    // Initialize components when the DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
        loadComponents().then(() => {
            // Initialize application after all components are loaded
            if (window.initializeApp) {
                window.initializeApp();
            }
            // Inicijalizuj prikaz površine
            initPovrsina();
        });
    });
</script>
<script>
// ...existing code...
function exportData() {
    const data = {
        potrosnja: getData('potrosnja'),
        prihod: getData('prihod'),
        exportDate: new Date().toISOString()
    };
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'laser-finansije-' + new Date().toISOString().split('T')[0] + '.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

function importData(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                if (data.potrosnja && data.prihod) {
                    setData(potrosnjaKey, data.potrosnja);
                    setData(prihodKey, data.prihod);
                    renderTabele();
                    alert('Podaci su uspešno uvezeni!');
                } else {
                    alert('Nevažeći format fajla!');
                }
            } catch (err) {
                alert('Greška pri učitavanju fajla!');
            }
        };
        reader.readAsText(file);
    }
    event.target.value = ''; // Reset input
}

function clearData() {
    localStorage.removeItem(potrosnjaKey);
    localStorage.removeItem(prihodKey);
    renderTabele();
}

// ...existing code...
</script>
<script>
// GitHub konfiguracija

const GITHUB_USERNAME = ''; // Ovde dodaj svoj GitHub username
const REPO_NAME = 'laser-finansije'; // Ime repozitorijuma
const DATA_FILE = 'data.json';

async function getData() {
    try {
        const response = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${DATA_FILE}`, {
            headers: {
                'Authorization': `token ${GITHUB_TOKEN}`,
                'Accept': 'application/vnd.github.v3+json'
            }
        });

        if (!response.ok) {
            throw new Error('Nije moguće učitati podatke');
        }

        const data = await response.json();
        const content = atob(data.sha ? data.content : 'eyJwb3Ryb3NuamEiOltdLCJwcmlob2QiOltdfQ==');
        return JSON.parse(content);
    } catch (error) {
        console.error('Greška pri učitavanju podataka:', error);
        return { potrosnja: [], prihod: [] };
    }
}

async function setData(data) {
    try {
        // Prvo dobavi trenutni sadržaj da bismo dobili SHA
        const currentFile = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${DATA_FILE}`, {
            headers: {
                'Authorization': `token ${GITHUB_TOKEN}`,
                'Accept': 'application/vnd.github.v3+json'
            }
        }).then(res => res.json()).catch(() => null);

        const content = btoa(JSON.stringify(data, null, 2));

        const response = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${DATA_FILE}`, {
            method: 'PUT',
            headers: {
                'Authorization': `token ${GITHUB_TOKEN}`,
                'Accept': 'application/vnd.github.v3+json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                message: 'Ažuriranje finansijskih podataka',
                content: content,
                sha: currentFile ? currentFile.sha : null
            })
        });

        if (!response.ok) {
            throw new Error('Nije moguće sačuvati podatke');
        }

        return true;
    } catch (error) {
        console.error('Greška pri čuvanju podataka:', error);
        alert('Došlo je do greške pri čuvanju podataka. Proverite konzolu za više detalja.');
        return false;
    }
}

function renderTabele() {
    const potrosnja = getData(potrosnjaKey);
    const prihod = getData(prihodKey);
    const potrosnjaTbody = document.querySelector('#potrosnjaTabela tbody');
    const prihodTbody = document.querySelector('#prihodTabela tbody');
    potrosnjaTbody.innerHTML = '';
    prihodTbody.innerHTML = '';
    let saldoPotrosnje = 0;
    let saldoProdaje = 0;
    potrosnja.forEach((item, idx) => {
        const ukupno = item.kolicina * item.cena;
        saldoPotrosnje += ukupno;
        potrosnjaTbody.innerHTML += `<tr><td>${item.materijal}</td><td>${item.kolicina}</td><td>${item.cena}</td><td>${ukupno}</td><td>${item.datum}</td><td><button class='btn btn-danger btn-sm' onclick='obrisiPotrosnju(${idx})'>X</button></td></tr>`;
    });
    prihod.forEach((item, idx) => {
        saldoProdaje += item.iznos;
        prihodTbody.innerHTML += `<tr><td>${item.opis}</td><td>${item.iznos}</td><td>${item.datum}</td><td><button class='btn btn-danger btn-sm' onclick='obrisiPrihod(${idx})'>X</button></td></tr>`;
    });    // Ažuriranje metrika    document.getElementById('ukupanPrihod').textContent = saldoProdaje.toLocaleString() + ' RSD';
    document.getElementById('ukupanRashod').textContent = saldoPotrosnje.toLocaleString() + ' RSD';
    document.getElementById('ukupanProfit').textContent = profit.toLocaleString() + ' RSD';
    document.getElementById('netoMarza').textContent = marza + '%';

    // Sačuvaj u localStorage nakon svake promene
    console.log('Podaci sačuvani. Trenutno stanje:', {
        'Ukupan prihod': saldoProdaje,
        'Ukupan rashod': saldoPotrosnje,
        'Profit': profit,
        'Neto marža': marza + '%'
    });
    renderCharts(potrosnja, prihod);
}

function obrisiPotrosnju(idx) {
    const potrosnja = getData(potrosnjaKey);
    potrosnja.splice(idx, 1);
    setData(potrosnjaKey, potrosnja);
    renderTabele();
}
function obrisiPrihod(idx) {
    const prihod = getData(prihodKey);
    prihod.splice(idx, 1);
    setData(prihodKey, prihod);
    renderTabele();
}

document.getElementById('potrosnjaForm').onsubmit = function(e) {
    e.preventDefault();
    const f = e.target;
    const novi = {
        materijal: f.materijal.value,
        kolicina: Number(f.kolicina.value),
        cena: Number(f.cena.value),
        datum: f.datum.value
    };
    const potrosnja = getData(potrosnjaKey);
    potrosnja.push(novi);
    setData(potrosnjaKey, potrosnja);
    f.reset();
    renderTabele();
};
document.getElementById('prihodForm').onsubmit = function(e) {
    e.preventDefault();
    const f = e.target;
    const novi = {
        opis: f.opis.value,
        iznos: Number(f.iznos.value),
        datum: f.datum.value
    };
    const prihod = getData(prihodKey);
    prihod.push(novi);
    setData(prihodKey, prihod);
    f.reset();
    renderTabele();
};

document.getElementById('godinaSelect').addEventListener('change', () => renderTabele());
document.getElementById('mesecSelect').addEventListener('change', () => renderTabele());

// Postavi trenutnu godinu kao default
document.getElementById('godinaSelect').value = new Date().getFullYear();

let saldoChart, materijalChart;
function filterByDate(data) {
    const godina = document.getElementById('godinaSelect').value;
    const mesec = document.getElementById('mesecSelect').value;

    return data.filter(item => {
        const datum = new Date(item.datum);
        const godinaOk = datum.getFullYear().toString() === godina;
        const mesecOk = mesec === 'all' || (datum.getMonth() + 1).toString() === mesec;
        return godinaOk && mesecOk;
    });
}

function renderCharts(potrosnja, prihod) {
    const filteredPotrosnja = filterByDate(potrosnja);
    const filteredPrihod = filterByDate(prihod);

    // Saldo chart
    const saldoCtx = document.getElementById('saldoChart').getContext('2d');
    const saldoPotrosnje = filteredPotrosnja.reduce((a, b) => a + b.kolicina * b.cena, 0);
    const saldoProdaje = filteredPrihod.reduce((a, b) => a + b.iznos, 0);
    const profit = saldoProdaje - saldoPotrosnje;
    const marza = saldoProdaje ? (profit / saldoProdaje * 100).toFixed(1) : 0;    // Kreiranje dnevnog pregleda za linijski grafikon
    const dnevniPodaci = {};
    filteredPotrosnja.forEach(item => {
        dnevniPodaci[item.datum] = (dnevniPodaci[item.datum] || 0) + (item.kolicina * item.cena);
    });

    const sortiraniDatumi = Object.keys(dnevniPodaci).sort();

    if (saldoChart) saldoChart.destroy();
    saldoChart = new Chart(saldoCtx, {
        type: 'line',
        data: {
            labels: sortiraniDatumi,
            datasets: [{
                label: 'Dnevni troškovi',
                data: sortiraniDatumi.map(datum => dnevniPodaci[datum]),
                borderColor: '#2977c9',
                backgroundColor: 'rgba(41, 119, 201, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: false },
                title: {
                    display: true,
                    text: 'Troškovi po danima',
                    color: 'white'
                }
            },
            scales: {
                x: {
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: { color: 'white' }
                },
                y: {
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: { color: 'white' }
                }
            }
        }
    });
    // Materijal chart
    const materijalCtx = document.getElementById('materijalChart').getContext('2d');
    const materijali = {};
    potrosnja.forEach(item => {
        materijali[item.materijal] = (materijali[item.materijal] || 0) + item.kolicina * item.cena;
    });
    if (materijalChart) materijalChart.destroy();
    materijalChart = new Chart(materijalCtx, {
        type: 'pie',
        data: {
            labels: Object.keys(materijali),
            datasets: [{
                data: Object.values(materijali),
                backgroundColor: [
                    '#ff6384', '#36a2eb', '#ffce56', '#4bc0c0', '#9966ff', '#f67019', '#00a950'
                ]
            }]
        },
        options: { responsive: true }
    });
}

renderTabele();
</script>
</body>
</html>
const GITHUB_USERNAME = ''; // Ovde dodaj svoj GitHub username
const REPO_NAME = 'laser-finansije'; // Ime repozitorijuma
const DATA_FILE = 'data.json';

async function getData() {
    try {
        const response = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${DATA_FILE}`, {
            headers: {
                'Authorization': `token ${GITHUB_TOKEN}`,
                'Accept': 'application/vnd.github.v3+json'
            }
        });

        if (!response.ok) {
            throw new Error('Nije moguće učitati podatke');
        }

        const data = await response.json();
        const content = atob(data.sha ? data.content : 'eyJwb3Ryb3NuamEiOltdLCJwcmlob2QiOltdfQ==');
        return JSON.parse(content);
    } catch (error) {
        console.error('Greška pri učitavanju podataka:', error);
        return { potrosnja: [], prihod: [] };
    }
}

async function setData(data) {
    try {
        // Prvo dobavi trenutni sadržaj da bismo dobili SHA
        const currentFile = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${DATA_FILE}`, {
            headers: {
                'Authorization': `token ${GITHUB_TOKEN}`,
                'Accept': 'application/vnd.github.v3+json'
            }
        }).then(res => res.json()).catch(() => null);

        const content = btoa(JSON.stringify(data, null, 2));

        const response = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${DATA_FILE}`, {
            method: 'PUT',
            headers: {
                'Authorization': `token ${GITHUB_TOKEN}`,
                'Accept': 'application/vnd.github.v3+json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                message: 'Ažuriranje finansijskih podataka',
                content: content,
                sha: currentFile ? currentFile.sha : null
            })
        });

        if (!response.ok) {
            throw new Error('Nije moguće sačuvati podatke');
        }

        return true;
    } catch (error) {
        console.error('Greška pri čuvanju podataka:', error);
        alert('Došlo je do greške pri čuvanju podataka. Proverite konzolu za više detalja.');
        return false;
    }
}

function renderTabele() {
    const potrosnja = getData(potrosnjaKey);
    const prihod = getData(prihodKey);
    const potrosnjaTbody = document.querySelector('#potrosnjaTabela tbody');
    const prihodTbody = document.querySelector('#prihodTabela tbody');
    potrosnjaTbody.innerHTML = '';
    prihodTbody.innerHTML = '';
    let saldoPotrosnje = 0;
    let saldoProdaje = 0;
    potrosnja.forEach((item, idx) => {
        const ukupno = item.kolicina * item.cena;
        saldoPotrosnje += ukupno;
        potrosnjaTbody.innerHTML += `<tr><td>${item.materijal}</td><td>${item.kolicina}</td><td>${item.cena}</td><td>${ukupno}</td><td>${item.datum}</td><td><button class='btn btn-danger btn-sm' onclick='obrisiPotrosnju(${idx})'>X</button></td></tr>`;
    });
    prihod.forEach((item, idx) => {
        saldoProdaje += item.iznos;
        prihodTbody.innerHTML += `<tr><td>${item.opis}</td><td>${item.iznos}</td><td>${item.datum}</td><td><button class='btn btn-danger btn-sm' onclick='obrisiPrihod(${idx})'>X</button></td></tr>`;
    });    // Ažuriranje metrika    document.getElementById('ukupanPrihod').textContent = saldoProdaje.toLocaleString() + ' RSD';
    document.getElementById('ukupanRashod').textContent = saldoPotrosnje.toLocaleString() + ' RSD';
    document.getElementById('ukupanProfit').textContent = profit.toLocaleString() + ' RSD';
    document.getElementById('netoMarza').textContent = marza + '%';

    // Sačuvaj u localStorage nakon svake promene
    console.log('Podaci sačuvani. Trenutno stanje:', {
        'Ukupan prihod': saldoProdaje,
        'Ukupan rashod': saldoPotrosnje,
        'Profit': profit,
        'Neto marža': marza + '%'
    });
    renderCharts(potrosnja, prihod);
}

function obrisiPotrosnju(idx) {
    const potrosnja = getData(potrosnjaKey);
    potrosnja.splice(idx, 1);
    setData(potrosnjaKey, potrosnja);
    renderTabele();
}
function obrisiPrihod(idx) {
    const prihod = getData(prihodKey);
    prihod.splice(idx, 1);
    setData(prihodKey, prihod);
    renderTabele();
}

document.getElementById('potrosnjaForm').onsubmit = function(e) {
    e.preventDefault();
    const f = e.target;
    const novi = {
        materijal: f.materijal.value,
        kolicina: Number(f.kolicina.value),
        cena: Number(f.cena.value),
        datum: f.datum.value
    };
    const potrosnja = getData(potrosnjaKey);
    potrosnja.push(novi);
    setData(potrosnjaKey, potrosnja);
    f.reset();
    renderTabele();
};
document.getElementById('prihodForm').onsubmit = function(e) {
    e.preventDefault();
    const f = e.target;
    const novi = {
        opis: f.opis.value,
        iznos: Number(f.iznos.value),
        datum: f.datum.value
    };
    const prihod = getData(prihodKey);
    prihod.push(novi);
    setData(prihodKey, prihod);
    f.reset();
    renderTabele();
};

document.getElementById('godinaSelect').addEventListener('change', () => renderTabele());
document.getElementById('mesecSelect').addEventListener('change', () => renderTabele());

// Postavi trenutnu godinu kao default
document.getElementById('godinaSelect').value = new Date().getFullYear();

let saldoChart, materijalChart;
function filterByDate(data) {
    const godina = document.getElementById('godinaSelect').value;
    const mesec = document.getElementById('mesecSelect').value;

    return data.filter(item => {
        const datum = new Date(item.datum);
        const godinaOk = datum.getFullYear().toString() === godina;
        const mesecOk = mesec === 'all' || (datum.getMonth() + 1).toString() === mesec;
        return godinaOk && mesecOk;
    });
}

function renderCharts(potrosnja, prihod) {
    const filteredPotrosnja = filterByDate(potrosnja);
    const filteredPrihod = filterByDate(prihod);

    // Saldo chart
    const saldoCtx = document.getElementById('saldoChart').getContext('2d');
    const saldoPotrosnje = filteredPotrosnja.reduce((a, b) => a + b.kolicina * b.cena, 0);
    const saldoProdaje = filteredPrihod.reduce((a, b) => a + b.iznos, 0);
    const profit = saldoProdaje - saldoPotrosnje;
    const marza = saldoProdaje ? (profit / saldoProdaje * 100).toFixed(1) : 0;    // Kreiranje dnevnog pregleda za linijski grafikon
    const dnevniPodaci = {};
    filteredPotrosnja.forEach(item => {
        dnevniPodaci[item.datum] = (dnevniPodaci[item.datum] || 0) + (item.kolicina * item.cena);
    });

    const sortiraniDatumi = Object.keys(dnevniPodaci).sort();

    if (saldoChart) saldoChart.destroy();
    saldoChart = new Chart(saldoCtx, {
        type: 'line',
        data: {
            labels: sortiraniDatumi,
            datasets: [{
                label: 'Dnevni troškovi',
                data: sortiraniDatumi.map(datum => dnevniPodaci[datum]),
                borderColor: '#2977c9',
                backgroundColor: 'rgba(41, 119, 201, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: false },
                title: {
                    display: true,
                    text: 'Troškovi po danima',
                    color: 'white'
                }
            },
            scales: {
                x: {
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: { color: 'white' }
                },
                y: {
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: { color: 'white' }
                }
            }
        }
    });
    // Materijal chart
    const materijalCtx = document.getElementById('materijalChart').getContext('2d');
    const materijali = {};
    potrosnja.forEach(item => {
        materijali[item.materijal] = (materijali[item.materijal] || 0) + item.kolicina * item.cena;
    });
    if (materijalChart) materijalChart.destroy();
    materijalChart = new Chart(materijalCtx, {
        type: 'pie',
        data: {
            labels: Object.keys(materijali),
            datasets: [{
                data: Object.values(materijali),
                backgroundColor: [
                    '#ff6384', '#36a2eb', '#ffce56', '#4bc0c0', '#9966ff', '#f67019', '#00a950'
                ]
            }]
        },
        options: { responsive: true }
    });
}

renderTabele();
</script>
</body>
